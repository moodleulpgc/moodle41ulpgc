{"version":3,"file":"crossword.min.js","sources":["../src/crossword.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * JavaScript to make crossword question.\n *\n * @module qtype_crossword/crossword\n * @copyright 2022 The Open University\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport {CrosswordGrid} from 'qtype_crossword/crossword_grid';\n\n/**\n * Get list of words object from moodle form to display in the preview section.\n *\n * @return {array} List of the words object. E.g: {answer: PARIS, clue: sample clue, no: word number in the form}\n */\nconst getWordsFromForm = function() {\n    const alphaRegex = /^[a-z]+/;\n    const numberAnswer = document.querySelectorAll('[id^=\"fitem_id_answer\"]').length;\n    let words = [];\n\n    if (numberAnswer > 0) {\n        for (let no = 0; no < numberAnswer; no++) {\n            const coordinateEl = document.querySelector('#fgroup_id_coodinateoptions_' + no);\n            const answerEl = document.querySelector('#fitem_id_answer_' + no);\n            const clueEl = document.querySelector('#fitem_id_clue_' + no);\n            let word = {};\n            word.no = no + 1;\n\n            if (!coordinateEl || !answerEl || !clueEl) {\n                continue;\n            }\n\n            coordinateEl.querySelectorAll('select').forEach(selectEl => {\n                const name = selectEl.name.match(alphaRegex)?.pop();\n                word[name] = selectEl.selectedIndex;\n            });\n\n            word.answer = answerEl.querySelector('input[id^=\"id_answer\"]').value.normalize('NFKC');\n            let clueData = clueEl.querySelector('textarea[id^=\"id_clue_\"]').value.trim();\n            // If it is a HTML empty content, set clue to empty.\n            if (htmlIsEmpty(clueData)) {\n                clueData = '';\n            }\n            word.clue = clueData;\n            words.push(word);\n        }\n    }\n\n    return words;\n};\n\nconst EMPTY_EDITOR_CONTENT = [\n    // For FF and Chrome.\n    '<p></p>',\n    '<p><br></p>',\n    '<br>',\n    '<p dir=\"rtl\" style=\"text-align: right;\"></p>',\n    '<p dir=\"rtl\" style=\"text-align: right;\"><br></p>',\n    '<p dir=\"ltr\" style=\"text-align: left;\"></p>',\n    '<p dir=\"ltr\" style=\"text-align: left;\"><br></p>',\n    // For IE 9 and 10.\n    '<p>&nbsp;</p>',\n    '<p><br>&nbsp;</p>',\n    '<p dir=\"rtl\" style=\"text-align: right;\">&nbsp;</p>',\n    '<p dir=\"rtl\" style=\"text-align: right;\"><br>&nbsp;</p>',\n    '<p dir=\"ltr\" style=\"text-align: left;\">&nbsp;</p>',\n    '<p dir=\"ltr\" style=\"text-align: left;\"><br>&nbsp;</p>'\n];\n\n/**\n * Check the HTML content is empty or not.\n *\n * @param {String} htmlContent HTML content include tags. E.g: <p>Sample html</p>\n * @return {boolean} return true if HTML content is consider empty.\n */\nexport const htmlIsEmpty = (htmlContent) => {\n    return EMPTY_EDITOR_CONTENT.includes(htmlContent);\n};\n\n/**\n * Handle action attempt crossword.\n *\n * @param {Object} options The crossword settings.\n */\nexport const attempt = (options) => {\n    const crossword = new CrosswordGrid(options);\n    crossword.buildCrossword();\n};\n\n/**\n * Handle action preview crossword.'\n *\n * @param {Object} options The crossword settings.\n */\nexport const preview = (options) => {\n    const element = document.querySelector(options.element);\n    if (element) {\n        element.removeAttribute('disabled');\n        element.addEventListener('click', function(event) {\n            event.preventDefault();\n            const columnEl = document.querySelector('select[name=\"numcolumns\"]');\n            const rowEl = document.querySelector('select[name=\"numrows\"]');\n            const words = getWordsFromForm(options.target);\n            const settings = {...options,\n                words,\n                colsNum: columnEl.options[columnEl.selectedIndex].text,\n                rowsNum: rowEl.options[rowEl.selectedIndex].text\n            };\n            const crossword = new CrosswordGrid(settings);\n            crossword.previewCrossword();\n        });\n    }\n};\n"],"names":["EMPTY_EDITOR_CONTENT","htmlIsEmpty","htmlContent","includes","options","CrosswordGrid","buildCrossword","element","document","querySelector","removeAttribute","addEventListener","event","preventDefault","columnEl","rowEl","words","alphaRegex","numberAnswer","querySelectorAll","length","no","coordinateEl","answerEl","clueEl","word","forEach","selectEl","name","match","_selectEl$name$match","pop","selectedIndex","answer","value","normalize","clueData","trim","clue","push","getWordsFromForm","target","settings","colsNum","text","rowsNum","previewCrossword"],"mappings":";;;;;;;;MAiEMA,qBAAuB,CAEzB,UACA,cACA,OACA,+CACA,mDACA,8CACA,kDAEA,gBACA,oBACA,qDACA,yDACA,oDACA,yDASSC,YAAeC,aACjBF,qBAAqBG,SAASD,+DAQjBE,UACF,IAAIC,8BAAcD,SAC1BE,mCAQUF,gBACdG,QAAUC,SAASC,cAAcL,QAAQG,SAC3CA,UACAA,QAAQG,gBAAgB,YACxBH,QAAQI,iBAAiB,SAAS,SAASC,OACvCA,MAAMC,uBACAC,SAAWN,SAASC,cAAc,6BAClCM,MAAQP,SAASC,cAAc,0BAC/BO,MAvFO,iBACfC,WAAa,UACbC,aAAeV,SAASW,iBAAiB,2BAA2BC,WACtEJ,MAAQ,MAERE,aAAe,MACV,IAAIG,GAAK,EAAGA,GAAKH,aAAcG,KAAM,OAChCC,aAAed,SAASC,cAAc,+BAAiCY,IACvEE,SAAWf,SAASC,cAAc,oBAAsBY,IACxDG,OAAShB,SAASC,cAAc,kBAAoBY,QACtDI,KAAO,MACXA,KAAKJ,GAAKA,GAAK,GAEVC,eAAiBC,WAAaC,gBAInCF,aAAaH,iBAAiB,UAAUO,SAAQC,0CACtCC,kCAAOD,SAASC,KAAKC,MAAMZ,mDAApBa,qBAAiCC,MAC9CN,KAAKG,MAAQD,SAASK,iBAG1BP,KAAKQ,OAASV,SAASd,cAAc,0BAA0ByB,MAAMC,UAAU,YAC3EC,SAAWZ,OAAOf,cAAc,4BAA4ByB,MAAMG,OAElEpC,YAAYmC,YACZA,SAAW,IAEfX,KAAKa,KAAOF,SACZpB,MAAMuB,KAAKd,aAIZT,MAsDewB,CAAiBpC,QAAQqC,QACjCC,SAAW,IAAItC,QACjBY,MAAAA,MACA2B,QAAS7B,SAASV,QAAQU,SAASkB,eAAeY,KAClDC,QAAS9B,MAAMX,QAAQW,MAAMiB,eAAeY,MAE9B,IAAIvC,8BAAcqC,UAC1BI"}