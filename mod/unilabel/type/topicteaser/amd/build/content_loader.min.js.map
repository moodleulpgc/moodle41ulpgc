{"version":3,"file":"content_loader.min.js","sources":["../src/content_loader.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * unilabel type topicteaser\n *\n * @author      Andreas Grabs <info@grabs-edv.de>\n * @copyright   2022 onwards Grabs EDV {@link https://www.grabs-edv.de}\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine([\n        'jquery',\n        'core/fragment',\n        'core/templates',\n        'core/notification'\n    ],\n    function($, fragment, templates, notification) {\n\n        /**\n         * Class constructor\n         * @param {string} contentcontainerselector\n         * @param {string} fragmentcall\n         * @param {object} serviceparams\n         * @param {int} contextid\n         */\n        var ContentLoader = function(contentcontainerselector, fragmentcall, serviceparams, contextid) {\n            this.contentcontainerselector = contentcontainerselector;\n            this.fragmentcall = fragmentcall;\n            if (serviceparams === undefined) {\n                this.serviceparams = {};\n            } else {\n                this.serviceparams = serviceparams;\n            }\n            this.contextid = contextid;\n            this.isshown = false;\n        };\n\n        /**\n         * Load a html content inside the container.\n         */\n        ContentLoader.prototype.loadContent = function() {\n            var _this = this; // We have to save this because the context in the promise is another.\n            _this._load();\n        };\n\n        /**\n         * Replace the container with new html content.\n         */\n        ContentLoader.prototype.replaceContent = function() {\n            var _this = this; // We have to save this because the context in the promise is another.\n            _this._load(true);\n        };\n\n        /**\n         * Load content by the fragment api\n         * @param {bool} replace\n         * @returns {promise}\n         */\n        ContentLoader.prototype._load = function(replace) {\n            var _this = this; // We have to save this because the context in the promise is another.\n            // Show a spinner while loading the table.\n            $(_this.contentcontainerselector).html('');\n            var spinnerhtml = '<div class=\"text-center\" id=\"myspinner\"><i class=\"fa fa-spinner fa-2x fa-spin\"></i></div>';\n            $(_this.contentcontainerselector).prepend(spinnerhtml);\n            var fragmentpromise = fragment.loadFragment(\n                'unilabeltype_topicteaser',\n                _this.fragmentcall,\n                _this.contextid,\n                _this.serviceparams\n            );\n            return fragmentpromise.then(function(html, js) {\n                if (replace) {\n                    $(_this.contentcontainerselector).replaceWith(html);\n                } else {\n                    $(_this.contentcontainerselector).html(html);\n                }\n                if (js) {\n                    templates.runTemplateJS(js);\n                }\n                _this.isshown = true;\n                $('#myspinner').remove();\n                return;\n            }).fail(notification.exception);\n        };\n\n        /**\n         * Load html content on the given event.\n         * @param {string} triggerselector\n         * @param {string} triggerevent\n         */\n        ContentLoader.prototype.autoload = function(triggerselector, triggerevent) {\n            var _this = this;\n            $(triggerselector).on(triggerevent, function() {\n                if (_this.isshown == false) {\n                    _this.loadContent();\n                    _this.isshown = true;\n                }\n            });\n        };\n\n        // Return an init method to call it directly from a php file.\n        return {\n            'init': function(\n                contentcontainerselector,\n                fragmentcall,\n                serviceparams,\n                contextid,\n                triggerselector,\n                triggerevent\n            ) {\n                var contentLoader = new ContentLoader(contentcontainerselector, fragmentcall, serviceparams, contextid);\n                contentLoader.autoload(triggerselector, triggerevent);\n            }\n        };\n    }\n);"],"names":["define","$","fragment","templates","notification","ContentLoader","contentcontainerselector","fragmentcall","serviceparams","contextid","undefined","isshown","prototype","loadContent","this","_load","replaceContent","replace","_this","html","prepend","loadFragment","then","js","replaceWith","runTemplateJS","remove","fail","exception","autoload","triggerselector","triggerevent","on"],"mappings":";;;;;;;AAuBAA,iDAAO,CACC,SACA,gBACA,iBACA,sBAEJ,SAASC,EAAGC,SAAUC,UAAWC,kBASzBC,cAAgB,SAASC,yBAA0BC,aAAcC,cAAeC,gBAC3EH,yBAA2BA,8BAC3BC,aAAeA,kBAEXC,mBADaE,IAAlBF,cACqB,GAEAA,mBAEpBC,UAAYA,eACZE,SAAU,UAMnBN,cAAcO,UAAUC,YAAc,WACtBC,KACNC,SAMVV,cAAcO,UAAUI,eAAiB,WACzBF,KACNC,OAAM,IAQhBV,cAAcO,UAAUG,MAAQ,SAASE,aACjCC,MAAQJ,KAEZb,EAAEiB,MAAMZ,0BAA0Ba,KAAK,WAEvClB,EAAEiB,MAAMZ,0BAA0Bc,QADhB,6FAEIlB,SAASmB,aAC3B,2BACAH,MAAMX,aACNW,MAAMT,UACNS,MAAMV,eAEac,MAAK,SAASH,KAAMI,IACnCN,QACAhB,EAAEiB,MAAMZ,0BAA0BkB,YAAYL,MAE9ClB,EAAEiB,MAAMZ,0BAA0Ba,KAAKA,MAEvCI,IACApB,UAAUsB,cAAcF,IAE5BL,MAAMP,SAAU,EAChBV,EAAE,cAAcyB,YAEjBC,KAAKvB,aAAawB,YAQzBvB,cAAcO,UAAUiB,SAAW,SAASC,gBAAiBC,kBACrDb,MAAQJ,KACZb,EAAE6B,iBAAiBE,GAAGD,cAAc,WACX,GAAjBb,MAAMP,UACNO,MAAML,cACNK,MAAMP,SAAU,OAMrB,MACK,SACJL,yBACAC,aACAC,cACAC,UACAqB,gBACAC,cAEoB,IAAI1B,cAAcC,yBAA0BC,aAAcC,cAAeC,WAC/EoB,SAASC,gBAAiBC"}