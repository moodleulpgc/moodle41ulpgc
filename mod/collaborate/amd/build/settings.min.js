/**
 * Settings JS.
 *
 * @package
 * @copyright Copyright (c) 2017 Open LMS
 * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_collaborate/settings",["jquery","core/str","core/templates"],(function($,str,templates){return{init:function(contextId){var modified=!1,strings={},checkFieldsComplete=function(flds){for(var f in flds){var fld=flds[f];if(""===""+$("#id_s_collaborate_"+fld).val().trim())return!1}return!0},checkRESTFieldsComplete=function(){return checkFieldsComplete(["restserver","restkey","restsecret"])},checkSOAPFieldsComplete=function(){return checkFieldsComplete(["server","username","password"])},apiMsg=function(stringKey,alertClass,extraClasses,api){var msg=strings[stringKey],msgContainer=$("#api_diag .noticetemplate_"+alertClass).children().first().clone();$(msgContainer).addClass(extraClasses),$(msgContainer).addClass(api),$(msgContainer).html('<span class="api-connection-msg">'+api+" - "+msg+"</span>"),$("#api_diag .api-connection-status .undefined").remove(),$("#api_diag .api-connection-status ."+api).remove(),$("#api_diag .api-connection-status").append($(msgContainer))},testRestApi=function(){var dataRest;checkRESTFieldsComplete()&&(apiMsg("verifyingapi","message","spinner","REST"),(dataRest={server:$("#id_s_collaborate_restserver").val().trim(),restkey:$("#id_s_collaborate_restkey").val().trim(),restsecret:$("#id_s_collaborate_restsecret").val()}).contextid=contextId,$.ajax({url:M.cfg.wwwroot+"/mod/collaborate/testapi.php",context:document.body,data:dataRest,success:function(data){data.success?apiMsg(modified?"connectionverifiedchanged":"connectionverified","success","","REST"):apiMsg("connectionfailed","problem","","REST")},error:function(){apiMsg("connectionfailed","problem","","REST")}}))},testSoapApi=function(){var dataSoap;checkSOAPFieldsComplete()&&(checkRESTFieldsComplete()||apiMsg("verifyingapi","message","spinner","SOAP"),(dataSoap={server:$("#id_s_collaborate_server").val().trim(),username:$("#id_s_collaborate_username").val().trim(),password:$("#id_s_collaborate_password").val()}).contextid=contextId,$.ajax({url:M.cfg.wwwroot+"/mod/collaborate/testapi.php",context:document.body,data:dataSoap,success:function(data){data.success?(apiMsg(modified?"connectionverifiedchanged":"connectionverified","success","","SOAP"),$(".soapapisettings").css("display","block")):checkRESTFieldsComplete()||apiMsg("connectionfailed","problem","","SOAP")},error:function(){checkRESTFieldsComplete()||apiMsg("connectionfailed","problem","","SOAP")}}))};str.get_strings([{key:"connectionfailed",component:"mod_collaborate"},{key:"connectionverified",component:"mod_collaborate"},{key:"verifyingapi",component:"mod_collaborate"},{key:"connectionstatusunknown",component:"mod_collaborate"}]).then((function(s){strings.connectionfailed=s[0],strings.connectionverified=s[1],strings.verifyingapi=s[2],strings.connectionstatusunknown=s[3],$("#id_s_collaborate_server, #id_s_collaborate_username, #id_s_collaborate_password").keypress((function(){modified=!0})),$(".api_diag_btn").click((function(e){e.preventDefault(),testRestApi(),testSoapApi()})),checkRESTFieldsComplete()&&testRestApi(),checkSOAPFieldsComplete()&&testSoapApi(),(/Edge\/\d./i.test(navigator.userAgent)||/MSIE/i.test(navigator.userAgent)||/Trident/i.test(navigator.userAgent))&&$('fieldset[disabled="true"] input').attr("disabled","true"),checkRESTFieldsComplete()||$(".soapapisettings").css("display","block")}))},uiinit:function(migrationStatus){if(migrationStatus&&migrationStatus<5){let selector="#page-mod-collaborate-mod section#region-main div[role='main']";"snap"===M.cfg.theme&&(selector="#page-mod-collaborate-mod main div[role='main']");const targetNode=document.querySelector(selector);targetNode&&targetNode.setAttribute("style","display: none;")}const targetNode=document.getElementById("id_largesessionenable");new MutationObserver((function(mutationsList){for(const i in mutationsList){const mutation=mutationsList[i];if("attributes"===mutation.type&&"disabled"===mutation.attributeName){const selectNode=$('[id="id_largesessionenable"]'),disabled=selectNode.is(":disabled");$(".collab-alert").length>0&&$(".collab-alert").remove(),disabled?str.get_strings([{key:"optionnotavailableforgroups",component:"mod_collaborate"}]).then((function(localizedstring){return"snap"===M.cfg.theme?templates.render("theme_snap/form_alert",{type:"warning",classes:"collab-alert",message:localizedstring}):'<div class="alert alert-warning collab-alert" role="alert">'+localizedstring+"</div>"})).then((function(html){selectNode.parent().parent().parent().append(html),"snap"===M.cfg.theme&&selectNode.parent().parent().parent().addClass("mod-collaborate-dimmed-option")})):"snap"===M.cfg.theme&&selectNode.parent().parent().parent().removeClass("mod-collaborate-dimmed-option")}}})).observe(targetNode,{attributes:!0})}}}));

//# sourceMappingURL=settings.min.js.map