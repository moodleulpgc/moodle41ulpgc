{"version":3,"sources":["../src/filter.js"],"names":["define","$","filterTerm","e","preventDefault","value","val","removeClass","addClass","M","util","set_user_preference","filterTeacher","filterCategory","filterTopLevelCategory","applyAllFilters","initialSettings","setting","$element","elementValue","hasOwnProperty","length","localBoostCOCRememberNotShownCourses","notshowncourses","each","index","element","height","push","id","slice","jsonstring","JSON","stringify","localBoostCOCRememberActiveFilters","activefilters","hiddenCount","parseInt","html","initFilter","params","on","local_boostcoc","initialsettings"],"mappings":"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","sourcesContent":["/**\n * Block \"course overview (campus)\" - JS code for filtering courses\n *\n * @package    block_course_termlist\n * @copyright  Enrique Castro <@ULPGC> based on block_course_termlist by Alexander Bias\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery'], function($) {\n    \"use strict\";\n\n    /**\n     * Function to filter the shown courses by term.\n     */\n    function filterTerm(e) {\n        // Prevent the event from refreshing the page.\n        if (e !== undefined) {\n            e.preventDefault();\n        }\n\n        var value = $('#ctl-filterterm').val();\n        if (value === \"all\") {\n            $('.termdiv').removeClass('ctl-hidden');\n        } else {\n            $('.termdiv').addClass('ctl-hidden');\n            $('.ctl-term-' + value).removeClass('ctl-hidden');\n            $('.ctl-term-').removeClass('ctl-hidden');\n            $('.ctl-term-0').removeClass('ctl-hidden');\n        }\n\n        // Store the users selection (Uses AJAX to save to the database).\n        M.util.set_user_preference('block_course_termlist-selectedterm', value);\n    }\n\n    /**\n     * Function to filter the shown courses by term teacher.\n     */\n    function filterTeacher(e) {\n        // Prevent the event from refreshing the page.\n        if (e !== undefined) {\n            e.preventDefault();\n        }\n\n        var value = $(\"#ctl-filterteacher\").val();\n        if (value === \"all\") {\n            $('.teacherdiv').removeClass('ctl-hidden');\n        } else {\n            $('.teacherdiv').addClass('ctl-hidden');\n            $('.ctl-teacher-' + value).removeClass('ctl-hidden');\n        }\n\n        // Store the users selection (Uses AJAX to save to the database).\n        M.util.set_user_preference('block_course_termlist-selectedteacher', value);\n    }\n\n    /**\n     * Function to filter the shown courses by parent category.\n     */\n    function filterCategory(e) {\n        // Prevent the event from refreshing the page.\n        if (e !== undefined) {\n            e.preventDefault();\n        }\n\n        var value = $(\"#ctl-filtercategory\").val();\n        if (value === \"all\") {\n            $('.categorydiv').removeClass('ctl-hidden');\n        } else {\n            $('.categorydiv').addClass('ctl-hidden');\n            $('.ctl-category-' + value).removeClass('ctl-hidden');\n        }\n\n        // Store the users selection (Uses AJAX to save to the database).\n        M.util.set_user_preference('block_course_termlist-selectedcategory', value);\n    }\n\n    /**\n     * Function to filter the shown courses by top level category.\n     */\n    function filterTopLevelCategory(e) {\n        // Prevent the event from refreshing the page.\n        if (e !== undefined) {\n            e.preventDefault();\n        }\n\n        var value = $(\"#ctl-filtertoplevelcategory\").val();\n        if (value === \"all\") {\n            $('.toplevelcategorydiv').removeClass('ctl-hidden');\n        } else {\n            $('.toplevelcategorydiv').addClass('ctl-hidden');\n            $('.ctl-toplevelcategory-' + value).removeClass('ctl-hidden');\n        }\n\n        // Store the users selection (Uses AJAX to save to the database).\n        M.util.set_user_preference('block_course_termlist-selectedtoplevelcategory', value);\n    }\n\n    /**\n     * Function to apply all filters again (used when the user has pushed the back button).\n     */\n    function applyAllFilters(initialSettings) {\n        /* eslint-disable max-depth */\n        var setting, value, $element, elementValue;\n        for (setting in initialSettings) {\n            if (initialSettings.hasOwnProperty(setting)) {\n                value = initialSettings[setting];\n                $element = $('#ctl-filter' + setting);\n                if ($element.length) {\n                    elementValue = $element.val();\n                    if (elementValue !== value) {\n                        switch (setting) {\n                            case 'term':\n                                filterTerm();\n                                break;\n                            case 'teacher':\n                                filterTeacher();\n                                break;\n                            case 'category':\n                                filterCategory();\n                                break;\n                            case 'toplevelcategory':\n                                filterTopLevelCategory();\n                                break;\n                        }\n                    }\n                }\n            }\n        }\n        /* eslint-enable max-depth */\n    }\n\n    /**\n     * Function to remember the not shown courses for local_boostcoc.\n     */\n    function localBoostCOCRememberNotShownCourses() {\n        // Get all course nodes which are not shown (= invisible = their height is 0) and store their IDs in an array.\n        var notshowncourses = new Array();\n        $('.ctl-course').each(function(index, element) {\n            if ($(element).height() == 0) {\n                notshowncourses.push(element.id.slice(11)); // This will remove \"ctl-course-\" from the id's string.\n            }\n        });\n\n        // Convert not shown courses array to JSON.\n        var jsonstring = JSON.stringify(notshowncourses);\n\n        // Store the current status of not shown courses (Uses AJAX to save to the database).\n        M.util.set_user_preference('local_boostctl-notshowncourses', jsonstring);\n    }\n\n    /**\n     * Function to remember the active filters for local_boostcoc.\n     */\n    function localBoostCOCRememberActiveFilters() {\n        // Get all active filters (value != all) and the fact that hidden courses are present and store them in an array.\n        var activefilters = new Array();\n        $('#ctl-filterterm, #ctl-filtercategory, #ctl-filtertoplevelcategory, #ctl-filterteacher').each(function(index, element) {\n            if ($(element).val() !== \"all\") {\n                activefilters.push(element.id.slice(4)); // This will remove \"ctl-\" from the id's string.\n            }\n        });\n        var hiddenCount = parseInt($('#ctl-hiddencoursescount').html(), 10);\n        if (hiddenCount > 0) {\n            activefilters.push('hidecourses');\n        }\n\n        // Convert not shown courses array to JSON.\n        var jsonstring = JSON.stringify(activefilters);\n\n        // Store the current status of active filters (Uses AJAX to save to the database).\n        M.util.set_user_preference('local_boostctl-activefilters', jsonstring);\n    }\n\n    return {\n        initFilter: function(params) {\n            // Add change listener to filter widgets.\n            $('#ctl-filterterm').on('change', filterTerm);\n            $('#ctl-filterteacher').on('change', filterTeacher);\n            $('#ctl-filtercategory').on('change', filterCategory);\n            $('#ctl-filtertoplevelcategory').on('change', filterTopLevelCategory);\n\n            // Add change listener to filter widgets for local_boostcoc.\n            if (params.local_boostcoc == true) {\n                $('#ctl-filterterm, #ctl-filterteacher, #ctl-filtercategory, #ctl-filtertoplevelcategory').on('change',\n                        localBoostCOCRememberNotShownCourses).on('change', localBoostCOCRememberActiveFilters);\n            }\n\n            // Make sure any initial filter settings are applied (may be needed if the user\n            // has used the browser 'back' button).\n            applyAllFilters(params.initialsettings);\n        }\n    };\n});\n"],"file":"filter.min.js"}